---
id: 59
title: Adding onto TFS with their API
date: 2013-05-08T00:00:00+00:00
author: Jorden
layout: post
guid: http://www.fbombcode.com/title/Adding_onto_TFS_with_their_API
permalink: /2013/05/08/adding-onto-tfs-with-their-api/
categories:
  - .net
tags:
  - .net
  - tfs
---
 <p> Just had the need to get a list of all changesets for a given list of user stories. Unfortunately, TFS does not have functionality to merge work items or user stories. So I decided to write a small program to give me a list of all the changesets for a given set of user stories. Hopefully this will give me a foundation for later tools in TFS. </p> <p> TFS has a large API and it can be crazy to go through, but I found out through looking on the internet what to look for in finding changesets. First, let&#8217;s add the assemblies: </p> <pre class="formatCode"> Microsoft.TeamFoundation.Client Microsoft.TeamFoundation.Common Microsoft.TeamFoundation.VersionControl.Client Microsoft.TeamFoundation.WorkItemTracking.Client </pre> <p> If you have Visual Studio installed, these assemblies should be GAC&#8217;d. Next, we need to connect to a project collection, which is the collection of code you are working in. ProjectCollection object gets the objects we can use to get work items, so let&#8217;s see that code: </p> <pre class="formatCode"> var projectCollection = TfsTeamProjectCollectionFactory.GetTeamProjectCollection(new Uri(\_myUri)); var versionControlServer = projectCollection.GetService<versionControlServer>(); var workItemStore = projectCollection.GetService<workItemStore>(); WorkItemCollection workItemCollection = workItemStore.Query( " SELECT [System.Id], [System.WorkItemType]," + " [System.State], [System.AssignedTo], [System.Title] " + " FROM WorkItems " + " WHERE [System.TeamProject] = '" + teamProject + "' ORDER BY [System.WorkItemType], [System.Id]"); </pre> <p> You might notice 2 things, the \_myurl and the &#8220;query&#8221;. The _myurl is the url to the TFS server, easy, and the query is the query for a work item, based on your team project. After you throw all this together, you get a work item collection. With this collection you can get all the work item/user story links and change set links. </p> <p> <strong>SPECIAL NOTE</strong>: TFS can link anything, this means you could have a circular reference. Be aware of this. </p> <p> Now that we got the note out of the way, let&#8217;s check out some of the code: </p> <pre class="formatCode"> WorkItem wiDeliverable = workItemStore.GetWorkItem(workItemId); foreach (var changeset in wiDeliverable.Links .OfType<externalLink>() .Select(link => versionControlServer.ArtifactProvider.GetChangeset(new Uri(link.LinkedArtifactUri)))) { Console.WriteLine(changeset.ChangesetId); } foreach (WorkItemLink child in wiDeliverable.WorkItemLinks) { GetChangeSetValues(versionControlServer, workItemStore, child.TargetId); } </pre> <p> The last thing that is weird is that there are 2 different links. One is an artifact link and the other is work item link. Artifact is the changeset and the work item link is the link to other work items. Super easy, but confusing to navigate. That is it though, that is how you can get a list of changesets for a given user story. </p>