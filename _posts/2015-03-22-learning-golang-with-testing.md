---
id: 13
title: Learning Golang with Testing
date: 2015-03-22T00:00:00+00:00
author: Jorden
layout: post
guid: http://www.fbombcode.com/title/Learning_Golang_with_Testing
permalink: /2015/03/22/learning-golang-with-testing/
categories:
  - golang
  - unit testing
  - web
tags:
  - golang
  - unit testing
---
 <p> Over the past week I have been learning A LOT of golang. In order to do that, I need to set up a few things to create a Rest API, the SDK, environment, IDE, Debugger, Testing and code. I&#8217;ll show you what I ran into&#8230; </p> <h3>Installation and Environment</h3> <p> First, go grab Go from here: <a href="http://golang.org/doc/install">download page</a>. You shouldn&#8217;t have an problems installing it, outside of having to set up GOPATH environmental variable. PLEASE GO DO THAT. </p> <div class="alert alert-info"> <strong>Protip:</strong> if you are looking on line for information about GO, don&#8217;t just type GO, type GOLANG. </div> <p> The GOPATH is super important because it tells GO where all your GO code is going to live. This means your binaries that are shared, code from other repositories, EVERYTHING! This is because GO is a compiled language. If you have done some C++ coding, linker libraries and directories use to be a HUGE pain. While I think this has been resolved by most modern programming languages, it is nice to know that all my code is in one location. I put my go path here -> ~/git/GO . </p> <p> Sweet, now you can do some Golang, but you will need an IDE&#8230; </p> <h3> IDE </h3> <p> While you can use Sublime Text, Atom, or whatever editor you want, there is an open source editor called LiteIDE. LiteIDE is an editor specifically designed for GO and might serve you well. It does syntax highlighting, intellisense and even autocomplete. To install, be sure to have homebrew, <a href="http://caskroom.io/">brew cask</a> and try these commands: </p> <pre class="formatCode"> brew install brew-cask # This installs an extension for brew brew cask install liteide # This installs the IDE </pre> <h3>Debugging</h3> <p> LiteIDE, as well as others, can debug using GDB. If you have done some C++ using G++ or GCC, then you should be familiar with this tool. If not, use brew to install gdb. Even better, we can embed the tool into LiteIDE to get some debugging in the editor. To do this, you have to get GDB to trust LiteIDE, which is all explained in this article here: <a href="http://www.goinggo.net/2013/06/installing-go-gocode-gdb-and-liteide.html">Under Step 6</a>. If this is on a mac, you may have to trust some certs, so check out this article as well: <a href="http://www.opensource.apple.com/source/lldb/lldb-69/docs/code-signing.txt">http://www.opensource.apple.com/source/lldb/lldb-69/docs/code-signing.txt</a>. </p> <div class="alert alert-info"> <strong>Protip:</strong> While there is a debugger, gdb is very unstable and kinda sucks for GO. I would suggest utilizing unit tests to find out if code is working the way you want. </div> <h3>Testing and Coding</h3> <p> Now, you should have your environment set up, and probably wrote a hello world app. Let&#8217;s try for a Rest API. First, start off with a main.go file: </p> <pre class="formatCode"> package main import ( "log" "net/http" ) func main() { router := NewRouter() log.Fatal(http.ListenAndServe(":8080", router)) } </pre> <p> What we have here is a router, which will create a routes, then listen to port 8080. Let&#8217;s build our route.go file: </p> <pre class="formatCode"> package main import ( "github.com/gorilla/mux" "net/http" ) type Route struct { Name string Method string Pattern string HandlerFunc http.HandlerFunc } type Routes []Route func NewRouter() \*mux.Router { router := mux.NewRouter().StrictSlash(true) for \_, route := range routes { router. Methods(route.Method). Path(route.Pattern). Name(route.Name). Handler(route.HandlerFunc) } return router } var routes = Routes{ Route{ "GetData", "GET", "/api/data", Get\_Data, }, } </pre> <p> So, this shows us how to create a list of routes, and then how the router adds them to the route table. If you look at the routes array, each element should have a Name, a Verb, a Route and a handler (callback function). One last thing, the import at the top says github. So long as you have the repository system installed, whether github or mecurial, GO will automatically pull down that dependency and build it for you. The next file we will need to make is the handler, so let&#8217;s make a handler.go file: </p> <pre class="formatCode"> package main import ( "encoding/json" "net/http" ) func Get\_Data(response http.ResponseWriter, request \*http.Request) { json.NewEncoder(response).Encode("{ 'msg':'Hello World' }") } </pre> <p> With this code, when we call &#8216;/api/data&#8217;, we will get back a json message saying hello world. Noticed that we have a response writer (stream) and a request object. These are the 2 things you will need to complete a web call. Let&#8217;s talk about some Unit testing. </p> <p> Unit testing follows some conventions, like usually the name of the file under test with an underscore test. Example, handlers\_test.go . Let&#8217;s go ahead and make a unit test for our handlers.go file called handlers\_test.go: </p> <pre class="formatCode"> package main import ( "net/http/httptest" "testing" ) func TestHelloWorld\_Ok(t \*testing.T) { var response = httptest.NewRecorder() Get\_Data(response, nil) if response.Code != 200 { t.Errorf("Should have 200 status code. Response Code: %v", response.Code) } if response.Body.String() != "{ 'msg':'Hello World' }" { t.Errorf("Should have had a hello world. Body: %v", response.Body.String()) } } </pre> <p> What we have here is a test that mocks up request to Get\_Data. We look at the response and see what the status code is and the body. The tests should always start with Test and have a \*testing.T passed into the function. </p> <div class="alert alert-info"> <strong>Protip:</strong> Be sure to include the value in your error, so you can know why the test failed. </div> <p> That is my quick list of things to help you get going on your GOLANG project. If you want a larger REST service to check out, you can check out the service I have here: <a href="https://github.com/supermitsuba/RestApiDiscovery">https://github.com/supermitsuba/RestApiDiscovery</a> and here are some more links: </p> <pre class="formatCode"> http://thenewstack.io/make-a-restful-json-api-go/ https://gobyexample.com/ </pre>